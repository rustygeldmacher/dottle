#!/bin/bash

if [[ "$1" == "--help" ]]; then
  echo "Show modification status of repositories"
  exit 0
fi

repo=$1

function git_status()
{
  pushd $1 > /dev/null
  changed=$(git status --short)
  if [[ -n "$changed" ]]; then
    git status --short
  else
    echo " * No local changes"
  fi
  popd > /dev/null
}

function repo_status()
{
  local repo=$1
  echo "Repository: $repo"
  if [[ -e "$DOTTLE_HOME/topics/$repo/.git" ]]; then
    git_status "$DOTTLE_HOME/topics/$repo"
  else
    echo " * Not under source control"
  fi
}

function dottle_status()
{
  echo Dottle:
  git_status "$DOTTLE_HOME"
}

if [[ -z "$repo" ]]; then
  dottle_status
  for repo in $(find $DOTTLE_HOME/topics -mindepth 1 -maxdepth 1 -type d -or -type l); do
    repo=$(basename $repo)
    repo_status $repo
  done
elif [[ "$repo" == "dottle" ]]; then
  dottle_status
else
  repo_status $repo
fi

