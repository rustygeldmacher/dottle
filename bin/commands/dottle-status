#!/bin/bash

if [[ "$1" == "--help" ]]; then
  echo "Show modification status of repositories"
  exit 0
fi

repo=$1

function repo_status()
{
  local repo=$1
  echo "Repository: $repo"
  if [[ -e "$DOTTLE_HOME/topics/$repo/.git" ]]; then
    pushd $DOTTLE_HOME/topics/$repo > /dev/null
    git status --short
    popd > /dev/null
  else
    echo " * Not under source control"
  fi
}

function dottle_status()
{
  echo Dottle:
  pushd $DOTTLE_HOME > /dev/null
  git status --short
  popd > /dev/null
}

if [[ -z "$repo" ]]; then
  dottle_status
  for repo in $(find $DOTTLE_HOME/topics -mindepth 1 -maxdepth 1 -type d -or -type l); do
    repo=$(basename $repo)
    repo_status $repo
  done
elif [[ "$repo" == "dottle" ]]; then
  dottle_status
else
  repo_status $repo
fi

